#! /bin/sh

#### BEGIN INIT INFO
## Provides:          nginx
## Required-Start:    $all
## Required-Stop:     $all
## Default-Start:     2 3 4 5
## Default-Stop:      0 1 6
## Short-Description: starts the nginx web server
## Description:       starts nginx using start-stop-daemon
#### END INIT INFO

PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
DAEMON=/usr/local/openresty/nginx/sbin/nginx

test -x $DAEMON || exit 0

if [ -f /etc/default/nginx ]; then
  . /etc/default/nginx
fi

set -e

case "$1" in
  start)
    echo "Starting nginx: "
    start-stop-daemon --start --quiet --pidfile "$PID_FILE" --exec $DAEMON -- $DAEMON_OPTS || true
    echo "nginx."
    ;;
  stop)
    echo "Stopping nginx: "
    start-stop-daemon --stop --quiet --pidfile "$PID_FILE" --exec $DAEMON || true
    echo "nginx."
    ;;
  restart|force-reload)
    echo "Restarting nginx: "
    start-stop-daemon --stop --quiet --pidfile "$PID_FILE" --exec $DAEMON || true
    sleep 1
    start-stop-daemon --start --quiet --pidfile "$PID_FILE" --exec $DAEMON -- $DAEMON_OPTS || true
    echo "nginx."
    ;;
  reload)
    echo "Reloading nginx configuration: "
    start-stop-daemon --stop --signal HUP --quiet --pidfile "$PID_FILE" --exec $DAEMON || true
    echo "nginx."
    ;;
  *)
    echo "Usage: /etc/init.d/nginx (start|stop|restart|force-reload|reload)" >&2
    exit 1
    ;;
esac

exit 0
